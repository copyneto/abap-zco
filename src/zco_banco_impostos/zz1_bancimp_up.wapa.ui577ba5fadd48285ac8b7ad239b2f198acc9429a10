sap.ui.define([                                                                                                                                                                                                                                                
    "sap/m/library",                                                                                                                                                                                                                                           
    "sap/ui/export/Spreadsheet",                                                                                                                                                                                                                               
    "sap/ui/export/library",                                                                                                                                                                                                                                   
    "sap/m/Dialog",                                                                                                                                                                                                                                            
    "sap/m/MessageView",                                                                                                                                                                                                                                       
    "sap/m/Bar",                                                                                                                                                                                                                                               
    "sap/m/Button",                                                                                                                                                                                                                                            
    "sap/m/Text",                                                                                                                                                                                                                                              
    "sap/ui/core/IconPool",                                                                                                                                                                                                                                    
    "sap/m/MessageItem",                                                                                                                                                                                                                                       
    "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                             
    //bibliotecas necessárias para leitura do excel                                                                                                                                                                                                            
    "br/com/trescoracoes/bancoimpostos/upload/ext/controller/jszip",                                                                                                                                                                                           
    "br/com/trescoracoes/bancoimpostos/upload/ext/controller/xlsx"],                                                                                                                                                                                           
    function (MobileLibrary, spreadsheet, library, Dialog, MessageView, Bar, Button, Text, IconPool, MessageItem, JSONModel, jszip, xlsx) {                                                                                                                    
        "use strict";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        //Variáveis de contexto                                                                                                                                                                                                                                
        var oThisContext;                                                                                                                                                                                                                                      
        var oViewComponent;                                                                                                                                                                                                                                    
        var oI18n;                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
        //Variáveis de Mensagens de retorno                                                                                                                                                                                                                    
        var oMessageView;                                                                                                                                                                                                                                      
        var oMessageDialog;                                                                                                                                                                                                                                    
        var oBackButtonMessage;                                                                                                                                                                                                                                
        var oBtnMessages;                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        //Variáveis de diálogo upload                                                                                                                                                                                                                          
        var oFileUploader;                                                                                                                                                                                                                                     
        var oUploadDialog;                                                                                                                                                                                                                                     
        var oBtnUpload;                                                                                                                                                                                                                                        
        var oBtnClose;                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
        //Variáveis da leitura excel                                                                                                                                                                                                                           
        var oReaderExcel;                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        return {                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            onInit: function (oEvent) {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                //Contexto                                                                                                                                                                                                                                     
                oThisContext = this;                                                                                                                                                                                                                           
                oViewComponent = this.getOwnerComponent();                                                                                                                                                                                                     
                oI18n = this.getOwnerComponent().getModel("i18n").getResourceBundle();                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                //Montagem dos objetos principais                                                                                                                                                                                                              
                oBackButtonMessage = new Button({                                                                                                                                                                                                              
                    icon: IconPool.getIconURI("nav-back"),                                                                                                                                                                                                     
                    visible: false,                                                                                                                                                                                                                            
                    press: function () {                                                                                                                                                                                                                       
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var oMessageTemplate = new MessageItem({                                                                                                                                                                                                       
                    type: '{type}',                                                                                                                                                                                                                            
                    title: '{message}',                                                                                                                                                                                                                        
                    activeTitle: "{active}",                                                                                                                                                                                                                   
                    description: '{description}',                                                                                                                                                                                                              
                    subtitle: '{subtitle}',                                                                                                                                                                                                                    
                    counter: '{counter}',                                                                                                                                                                                                                      
                    groupName: '{group}'                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                oMessageView = new MessageView({                                                                                                                                                                                                               
                    showDetailsPageHeader: false,                                                                                                                                                                                                              
                    itemSelect: function () {                                                                                                                                                                                                                  
                        oBackButtonMessage.setVisible(true);                                                                                                                                                                                                   
                    },                                                                                                                                                                                                                                         
                    items: {                                                                                                                                                                                                                                   
                        path: "/",                                                                                                                                                                                                                             
                        template: oMessageTemplate                                                                                                                                                                                                             
                    },                                                                                                                                                                                                                                         
                    groupItems: true                                                                                                                                                                                                                           
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                oMessageDialog = new Dialog({                                                                                                                                                                                                                  
                    title: "Mensagens de retorno",                                                                                                                                                                                                             
                    resizable: true,                                                                                                                                                                                                                           
                    content: oMessageView,                                                                                                                                                                                                                     
                    state: 'Error',                                                                                                                                                                                                                            
                    customHeader: new Bar({                                                                                                                                                                                                                    
                        contentMiddle: [                                                                                                                                                                                                                       
                            new Text({ text: "Mensagens de retorno" })                                                                                                                                                                                         
                        ],                                                                                                                                                                                                                                     
                        contentLeft: [                                                                                                                                                                                                                         
                            oBackButtonMessage                                                                                                                                                                                                                 
                        ],                                                                                                                                                                                                                                     
                        contentRight: [                                                                                                                                                                                                                        
                            new Button({                                                                                                                                                                                                                       
                                press: function () {                                                                                                                                                                                                           
                                    oMessageDialog.close();                                                                                                                                                                                                    
                                },                                                                                                                                                                                                                             
                                icon: IconPool.getIconURI("decline"),                                                                                                                                                                                          
                                type: 'Reject'                                                                                                                                                                                                                 
                            })                                                                                                                                                                                                                                 
                        ]                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    contentHeight: "50%",                                                                                                                                                                                                                      
                    contentWidth: "28%",                                                                                                                                                                                                                       
                    verticalScrolling: false                                                                                                                                                                                                                   
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onChargeFile: function (oEvent) {                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                if (oUploadDialog == null) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    //Cria Diálogo dinâmico (pop-up)                                                                                                                                                                                                           
                    oUploadDialog = new Dialog({                                                                                                                                                                                                               
                        contentWidth: "300px",                                                                                                                                                                                                                 
                        resizable: true,                                                                                                                                                                                                                       
                        type: "Message"                                                                                                                                                                                                                        
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    // Tabela do listreport                                                                                                                                                                                                                    
                    var oTable = oEvent.getSource().getParent().getParent();                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    //Prepara o responsável pela carga do arquivo                                                                                                                                                                                              
                    oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                          
                        width: "100%",                                                                                                                                                                                                                         
                        fileType: ["xlsx"],                                                                                                                                                                                                                    
                        typeMissmatch: this.handleTypeMissmatch                                                                                                                                                                                                
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Cria botão para a carga do arquivo                                                                                                                                                                                                       
                    oBtnUpload = new sap.m.Button({                                                                                                                                                                                                            
                        text: 'Carregar',                                                                                                                                                                                                                      
                        type: 'Accept',                                                                                                                                                                                                                        
                        press: function (event) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            // Inativar tela - esperando                                                                                                                                                                                                       
                            oUploadDialog.setBusy(true);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            oFileUploader.checkFileReadable().then(function () {                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                // Verifica se arquivo foi informado                                                                                                                                                                                           
                                var domRef = oFileUploader.FUEl;                                                                                                                                                                                               
                                var file = domRef.files[0];                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                if (oFileUploader.getValue() === '') {                                                                                                                                                                                         
                                    sap.m.MessageToast.show(oI18n.getText("inforSelectArquive"));                                                                                                                                                              
                                    oUploadDialog.setBusy(false);                                                                                                                                                                                              
                                    return;                                                                                                                                                                                                                    
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                //Bloqueio botão de fechamento do diálogo                                                                                                                                                                                      
                                oBtnClose.setEnabled(false);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oThisContext.ExecuteReadExcel(domRef.files && domRef.files[0], oViewComponent.getModel(), oTable);                                                                                                                             
                                                                                                                                                                                                                                                               
                            }, function (error) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                oThisContext.handlerError(oI18n.getText("errorReaderExcel"))                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            }).then(function () {                                                                                                                                                                                                              
                                oFileUploader.clear();                                                                                                                                                                                                         
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Cria botão de fechar                                                                                                                                                                                                                     
                    oBtnClose = new sap.m.Button({                                                                                                                                                                                                             
                        icon: IconPool.getIconURI("decline"),                                                                                                                                                                                                  
                        type: 'Reject',                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        press: function () {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            oUploadDialog.close();                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var vVisible = false;                                                                                                                                                                                                                  
                        var vText = oMessageView.getModel().oData.length;                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        if (vText != 0) {                                                                                                                                                                                                                      
                            vVisible = true;                                                                                                                                                                                                                   
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                        //Não exibir                                                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oBtnMessages = new Button({                                                                                                                                                                                                                
                        icon: IconPool.getIconURI("message-error"),                                                                                                                                                                                            
                        type: "Negative",                                                                                                                                                                                                                      
                        text: vText,                                                                                                                                                                                                                           
                        visible: vVisible,                                                                                                                                                                                                                     
                        press: function () {                                                                                                                                                                                                                   
                            oMessageView.navigateBack();                                                                                                                                                                                                       
                            oBackButtonMessage.setVisible(false);                                                                                                                                                                                              
                            oMessageDialog.open();                                                                                                                                                                                                             
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Chama diálogo com a lógica de carga&nbsp;                                                                                                                                                                                                
                    oUploadDialog.addContent(oFileUploader);                                                                                                                                                                                                   
                    oUploadDialog.addButton(oBtnMessages);                                                                                                                                                                                                     
                    oUploadDialog.addButton(oBtnUpload);                                                                                                                                                                                                       
                    oUploadDialog.setCustomHeader(new Bar({                                                                                                                                                                                                    
                        contentMiddle: [                                                                                                                                                                                                                       
                            new Text({ text: oI18n.getText("dialogUpload") })                                                                                                                                                                                  
                        ],                                                                                                                                                                                                                                     
                        contentRight: [oBtnClose]                                                                                                                                                                                                              
                    }));                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oUploadDialog.open();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                } else {                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oUploadDialog.open();                                                                                                                                                                                                                      
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            handleTypeMissmatch: function (oEvent) {                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                var aFileTypes = oEvent.getSource().getFileType();                                                                                                                                                                                             
                jQuery.each(aFileTypes, function (key, value) { aFileTypes[key] = "*." + value; });                                                                                                                                                            
                var sSupportedFileTypes = aFileTypes.join(", ");                                                                                                                                                                                               
                sap.m.MessageToast.show("Tipo de arquivo *." + oEvent.getParameter("fileType") +                                                                                                                                                               
                    " não é suportado. Escolha um dos tipos a seguir: " +                                                                                                                                                                                      
                    sSupportedFileTypes);                                                                                                                                                                                                                      
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            ExecuteReadExcel: function (file, oModel, oTable) {                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                var excelData = {};                                                                                                                                                                                                                            
                var Success = true;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                if (file && window.FileReader) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    if (oReaderExcel == null) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        oReaderExcel = new FileReader();                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oReaderExcel.onload = function (e) {                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        var data = e.target.result;                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                        var workbook = XLSX.read(data, {                                                                                                                                                                                                       
                            type: 'binary'                                                                                                                                                                                                                     
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        workbook.SheetNames.forEach(function (sheetName) {                                                                                                                                                                                     
                            // Passagem da linha para o array                                                                                                                                                                                                  
                            excelData = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    };                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oReaderExcel.onloadend = function (e) {                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        if (Success) {                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                            //Validação/Preenchimento de campo com vazio para não gerar erro na passagem dos dados                                                                                                                                             
                            if (!oThisContext.validateFields(excelData)) {                                                                                                                                                                                     
                                return;                                                                                                                                                                                                                        
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            sap.m.MessageToast.show(oI18n.getText("inforInProcess"));                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                            //Executa chamadas da ação com os dados                                                                                                                                                                                            
                            oThisContext.ExecuteActionProcess(excelData, file, oModel, oTable);                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    };                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oReaderExcel.onerror = function (ex) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        Success = false;                                                                                                                                                                                                                       
                        oThisContext.handlerError(oI18n.getText("errorReaderExcel"));                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    };                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oReaderExcel.readAsBinaryString(file);                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                } else {                                                                                                                                                                                                                                       
                    //Implementar mensagem de erro                                                                                                                                                                                                             
                    oThisContext.handlerError(oI18n.getText("errorPageReader"));                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            validateFields: function (excelData) {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (excelData.length == 0) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        throw new UserException("ArquiveInvalid");                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    excelData.forEach(e => {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        //"Preeche" campo para evitar erro na chamada, validação será feita no backend                                                                                                                                                         
                        e.CodigoCenario = ((e.CodigoCenario == null) ? '' : e.CodigoCenario);                                                                                                                                                                  
                        e.Data = ((e.Data == null) ? '00000000' : e.Data);                                                                                                                                                                                     
                        e.Material = ((e.Material == null) ? '' : e.Material);                                                                                                                                                                                 
                        e.TipoAvaliacao = ((e.TipoAvaliacao == null) ? '' : e.TipoAvaliacao);                                                                                                                                                                  
                        e.Docnum = ((e.Docnum == null) ? '' : e.Docnum);                                                                                                                                                                                       
                        e.Empresa = ((e.Empresa == null) ? '' : e.Empresa);                                                                                                                                                                                    
                        e.CodigoCentro = ((e.CodigoCentro == null) ? '' : e.CodigoCentro);                                                                                                                                                                     
                        e.Divisao = ((e.Divisao == null) ? '' : e.Divisao);                                                                                                                                                                                    
                        e.ValorICMS = ((e.ValorICMS == null) ? 0 : e.ValorICMS);                                                                                                                                                                               
                        e.ValorICMSST = ((e.ValorICMSST == null) ? 0 : e.ValorICMSST);                                                                                                                                                                         
                        e.ValorIPI = ((e.ValorIPI == null) ? 0 : e.ValorIPI);                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        if (e.ValorICMS != 0) {                                                                                                                                                                                                                
                            e.ValorICMS = e.ValorICMS.replaceAll(" ", "");                                                                                                                                                                                     
                            e.ValorICMS = e.ValorICMS.replaceAll("-", "");                                                                                                                                                                                     
                            e.ValorICMS = e.ValorICMS.replaceAll(",", ".");                                                                                                                                                                                    
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        if (e.ValorICMSST != 0) {                                                                                                                                                                                                              
                            e.ValorICMSST = e.ValorICMSST.replaceAll(" ", "");                                                                                                                                                                                 
                            e.ValorICMSST = e.ValorICMSST.replaceAll("-", "");                                                                                                                                                                                 
                            e.ValorICMSST = e.ValorICMSST.replaceAll(",", ".");                                                                                                                                                                                
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        if (e.ValorIPI != 0) {                                                                                                                                                                                                                 
                            e.ValorIPI = e.ValorIPI.replaceAll(" ", "");                                                                                                                                                                                       
                            e.ValorIPI = e.ValorIPI.replaceAll("-", "");                                                                                                                                                                                       
                            e.ValorIPI = e.ValorIPI.replaceAll(",", ".");                                                                                                                                                                                      
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        e.ValorICMS = ((e.ValorICMS == '') ? 0 : e.ValorICMS);                                                                                                                                                                                 
                        e.ValorICMSST = ((e.ValorICMSST == '') ? 0 : e.ValorICMSST);                                                                                                                                                                           
                        e.ValorIPI = ((e.ValorIPI == '') ? 0 : e.ValorIPI);                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        e.Data = e.Data.replaceAll(".", "");                                                                                                                                                                                                   
                        e.Data = e.Data.replaceAll("-", "");                                                                                                                                                                                                   
                        e.Data = e.Data.replaceAll("/", "");                                                                                                                                                                                                   
                        e.Data = e.Data.replaceAll(":", "");                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        e.Data = e.Data.slice(4) + '-' + e.Data.slice(2, 4) + '-' + e.Data.slice(0, 2);                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    if (excelData.length == 0) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        oThisContext.handlerError(oI18n.getText("errorArquiveInitial"));                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    } else {                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        oThisContext.handlerError(oI18n.getText("errorLayoutIncorrect"));                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    return false;                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                return true;                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            ExecuteActionProcess: function (excelData, file, oModel, oTable) {                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                //Quantidade de linhas                                                                                                                                                                                                                         
                var vQuantity = excelData.length;                                                                                                                                                                                                              
                var vCount = 0;                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                // Remove mensagens do processo                                                                                                                                                                                                                
                try {                                                                                                                                                                                                                                          
                    sap.ui.getCore().getMessageManager().removeAllMessages();                                                                                                                                                                                  
                } catch (error) { }                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    excelData.forEach(e => {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        oModel.callFunction("/toProcessUpload",                                                                                                                                                                                                
                            {                                                                                                                                                                                                                                  
                                method: "POST",                                                                                                                                                                                                                
                                urlParameters: {                                                                                                                                                                                                               
                                    "Guid": '00000000-0000-0000-0000-000000000000',                                                                                                                                                                            
                                    "FileDirectory": file.name,                                                                                                                                                                                                
                                    "CodigoCenario": e.CodigoCenario,                                                                                                                                                                                          
                                    "Data": e.Data,                                                                                                                                                                                                            
                                    "Material": e.Material,                                                                                                                                                                                                    
                                    "TipoAvaliacao": e.TipoAvaliacao,                                                                                                                                                                                          
                                    "NotaFiscal": e.Docnum,                                                                                                                                                                                                    
                                    "Empresa": e.Empresa,                                                                                                                                                                                                      
                                    "Centro": e.CodigoCentro,                                                                                                                                                                                                  
                                    "Divisao": e.Divisao,                                                                                                                                                                                                      
                                    "ValorICMS": e.ValorICMS,                                                                                                                                                                                                  
                                    "ValorICMSST": e.ValorICMSST,                                                                                                                                                                                              
                                    "ValorIPI": e.ValorIPI,                                                                                                                                                                                                    
                                    "Moeda": 'BRL'                                                                                                                                                                                                             
                                },                                                                                                                                                                                                                             
                                success: function (oData, response) {                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                    vCount += + 1;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                    oThisContext.successActionProcess(vQuantity, vCount, oTable);                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                }.bind(this),                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                                error: function (oError) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                    vCount += + 1;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                    oThisContext.errorActionProcess(oError, vCount);                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                }.bind(this),                                                                                                                                                                                                                  
                                refreshAfterChange: true                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    oThisContext.handlerError(oI18n.getText("errorToProcessAction"));                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            successActionProcess: function (vQuantity, vCount, oTable) {                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    //Dados de mensagens retornadas do backend                                                                                                                                                                                                 
                    var oModelMessageManager = new JSONModel();                                                                                                                                                                                                
                    oModelMessageManager.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());                                                                                                                                            
                    oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    oBtnMessages.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);                                                                                                                                             
                                                                                                                                                                                                                                                               
                    if (sap.ui.getCore().getMessageManager().getMessageModel().getData().length != 0) {                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        oBtnMessages.setIcon(IconPool.getIconURI("message-success"));                                                                                                                                                                          
                        oBtnMessages.setType("Success");                                                                                                                                                                                                       
                        oBtnMessages.setVisible(true);                                                                                                                                                                                                         
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        oMessageDialog.open();                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    } else {                                                                                                                                                                                                                                   
                        oBtnMessages.setVisible(false);                                                                                                                                                                                                        
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    oBtnMessages.setVisible(false);                                                                                                                                                                                                            
                    sap.m.MessageToast.show(oI18n.getText("inforReturn"));                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oUploadDialog.setBusy(false);                                                                                                                                                                                                              
                    oBtnClose.setEnabled(true);                                                                                                                                                                                                                
                    oUploadDialog.close();                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    oThisContext.handlerError(oI18n.getText("errorDialog"));                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (oTable) {                                                                                                                                                                                                                              
                        oTable.getModel().refresh(true);                                                                                                                                                                                                       
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                } catch (error) { }                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            errorActionProcess: function (oError, vCount) {                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                if (vCount == 1) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var oModelMessageManager = new JSONModel();                                                                                                                                                                                            
                        oModelMessageManager.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());                                                                                                                                        
                        oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        oBtnMessages.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);                                                                                                                                         
                                                                                                                                                                                                                                                               
                        try {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            var rMessage = JSON.parse(oError.responseText);                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            if (rMessage.error.code == "005056A509B11EE1B9A8DBD9EA7BB778") {                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: oI18n.getText("errorModelExcel"),                                                                                                                                                                                 
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                oModelMessageManager.setData(sMessage);                                                                                                                                                                                        
                                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        } catch (error) { }                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        try {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (sap.ui.getCore().getMessageManager().getMessageModel().getData().length == 0) {                                                                                                                                                
                                                                                                                                                                                                                                                               
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: oI18n.getText("errorToReceiveReturnVS"),                                                                                                                                                                          
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                sMessage.push({                                                                                                                                                                                                                
                                    message: oI18n.getText("inforSuport"),                                                                                                                                                                                     
                                    type: "Information"                                                                                                                                                                                                        
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                let oModelMessageManager = new JSONModel();                                                                                                                                                                                    
                                oModelMessageManager.setData(sMessage);                                                                                                                                                                                        
                                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        } catch (error) { }                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                            
                        oBtnMessages.setType("Negative");                                                                                                                                                                                                      
                        oBtnMessages.setVisible(true);                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        oMessageDialog.open();                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        sap.m.MessageToast.show(oI18n.getText("errorToGetMessageReturn"));                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        oUploadDialog.setBusy(false);                                                                                                                                                                                                          
                        oBtnClose.setEnabled(true);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    } catch (error) { }                                                                                                                                                                                                                        
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            handlerError: function (vMessage) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                let sMessage = [];                                                                                                                                                                                                                             
                sMessage.push({                                                                                                                                                                                                                                
                    message: vMessage,                                                                                                                                                                                                                         
                    type: "Error"                                                                                                                                                                                                                              
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var oModelMessageManager = new JSONModel();                                                                                                                                                                                                    
                oModelMessageManager.setData(sMessage);                                                                                                                                                                                                        
                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                oBtnMessages.setText("1");                                                                                                                                                                                                                     
                oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                                    
                oBtnMessages.setType("Negative");                                                                                                                                                                                                              
                oBtnMessages.setVisible(true);                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                oMessageView.navigateBack();                                                                                                                                                                                                                   
                oBackButtonMessage.setVisible(false);                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                oMessageDialog.open();                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                oUploadDialog.setBusy(false);                                                                                                                                                                                                                  
                oBtnClose.setEnabled(true);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onGetModelFile: function (oEvent) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                //Monta layout de colunas                                                                                                                                                                                                                      
                var aCols = [];                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CodigoCenario',                                                                                                                                                                                                                    
                    property: 'CodigoCenario',                                                                                                                                                                                                                 
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Data',                                                                                                                                                                                                                             
                    property: 'Data',                                                                                                                                                                                                                          
                    type: sap.ui.model.type.Date                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Material',                                                                                                                                                                                                                         
                    property: 'Material',                                                                                                                                                                                                                      
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'TipoAvaliacao',                                                                                                                                                                                                                    
                    property: 'TipoAvaliacao',                                                                                                                                                                                                                 
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Docnum',                                                                                                                                                                                                                           
                    property: 'Docnum',                                                                                                                                                                                                                        
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Empresa',                                                                                                                                                                                                                          
                    property: 'Empresa',                                                                                                                                                                                                                       
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CodigoCentro',                                                                                                                                                                                                                     
                    property: 'CodigoCentro',                                                                                                                                                                                                                  
                    type: sap.ui.model.type.String                                                                                                                                                                                                             
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Divisao',                                                                                                                                                                                                                          
                    property: 'Divisao',                                                                                                                                                                                                                       
                    type: sap.ui.model.type.Integer                                                                                                                                                                                                            
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'ValorICMS',                                                                                                                                                                                                                        
                    property: 'ValorICMS',                                                                                                                                                                                                                     
                    type: sap.ui.model.type.Float                                                                                                                                                                                                              
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'ValorICMSST',                                                                                                                                                                                                                      
                    property: 'ValorICMSST',                                                                                                                                                                                                                   
                    type: sap.ui.model.type.Float                                                                                                                                                                                                              
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'ValorIPI',                                                                                                                                                                                                                         
                    property: 'ValorIPI',                                                                                                                                                                                                                      
                    type: sap.ui.model.type.Float                                                                                                                                                                                                              
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                //Prepara configurações                                                                                                                                                                                                                        
                var oSettings = {                                                                                                                                                                                                                              
                    workbook: { columns: aCols },                                                                                                                                                                                                              
                    dataSource: [{ Data: "01/01/0001" }],                                                                                                                                                                                                      
                    count: 1,                                                                                                                                                                                                                                  
                    fileName: 'BancoDeImpostos.xlsx'                                                                                                                                                                                                           
                };                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                //Cria planilha&nbsp;                                                                                                                                                                                                                          
                var oSheet = new spreadsheet(oSettings);                                                                                                                                                                                                       
                oSheet.build().finally(function () {                                                                                                                                                                                                           
                    oSheet.destroy();                                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               