sap.ui.define(["sap/m/library","sap/ui/export/Spreadsheet","sap/ui/export/library","sap/m/Dialog","sap/m/MessageView","sap/m/Bar","sap/m/Button","sap/m/Text","sap/ui/core/IconPool","sap/m/MessageItem","sap/ui/model/json/JSONModel","br/com/trescoracoes/ba+
ncoimpostos/upload/ext/controller/jszip","br/com/trescoracoes/bancoimpostos/upload/ext/controller/xlsx"],function(e,t,a,r,o,s,l,n,i,c,p,u,g){"use strict";var d;var M;var I;var f;var h;var y;var m;var C;var S;var v;var T;var V;return{onInit:function(e){d=+
this;M=this.getOwnerComponent();I=this.getOwnerComponent().getModel("i18n").getResourceBundle();y=new l({icon:i.getIconURI("nav-back"),visible:false,press:function(){f.navigateBack();y.setVisible(false)}});var t=new c({type:"{type}",title:"{message}",act+
iveTitle:"{active}",description:"{description}",subtitle:"{subtitle}",counter:"{counter}",groupName:"{group}"});f=new o({showDetailsPageHeader:false,itemSelect:function(){y.setVisible(true)},items:{path:"/",template:t},groupItems:true});h=new r({title:"M+
ensagens de retorno",resizable:true,content:f,state:"Error",customHeader:new s({contentMiddle:[new n({text:"Mensagens de retorno"})],contentLeft:[y],contentRight:[new l({press:function(){h.close()},icon:i.getIconURI("decline"),type:"Reject"})]}),contentH+
eight:"50%",contentWidth:"28%",verticalScrolling:false})},onChargeFile:function(e){if(S==null){S=new r({contentWidth:"300px",resizable:true,type:"Message"});var t=e.getSource().getParent().getParent();C=new sap.ui.unified.FileUploader({width:"100%",fileT+
ype:["xlsx"],typeMissmatch:this.handleTypeMissmatch});v=new sap.m.Button({text:"Carregar",type:"Accept",press:function(e){S.setBusy(true);C.checkFileReadable().then(function(){var e=C.FUEl;var a=e.files[0];if(C.getValue()===""){sap.m.MessageToast.show(I.+
getText("inforSelectArquive"));S.setBusy(false);return}T.setEnabled(false);d.ExecuteReadExcel(e.files&&e.files[0],M.getModel(),t)},function(e){d.handlerError(I.getText("errorReaderExcel"))}).then(function(){C.clear()})}});T=new sap.m.Button({icon:i.getIc+
onURI("decline"),type:"Reject",press:function(){S.close()}});try{var a=false;var o=f.getModel().oData.length;if(o!=0){a=true}}catch(e){}m=new l({icon:i.getIconURI("message-error"),type:"Negative",text:o,visible:a,press:function(){f.navigateBack();y.setVi+
sible(false);h.open()}});S.addContent(C);S.addButton(m);S.addButton(v);S.setCustomHeader(new s({contentMiddle:[new n({text:I.getText("dialogUpload")})],contentRight:[T]}));S.open()}else{S.open()}},handleTypeMissmatch:function(e){var t=e.getSource().getFi+
leType();jQuery.each(t,function(e,a){t[e]="*."+a});var a=t.join(", ");sap.m.MessageToast.show("Tipo de arquivo *."+e.getParameter("fileType")+" não é suportado. Escolha um dos tipos a seguir: "+a)},ExecuteReadExcel:function(e,t,a){var r={};var o=true;if(+
e&&window.FileReader){if(V==null){V=new FileReader}V.onload=function(e){var t=e.target.result;var a=XLSX.read(t,{type:"binary"});a.SheetNames.forEach(function(e){r=XLSX.utils.sheet_to_row_object_array(a.Sheets[e])})};V.onloadend=function(s){if(o){if(!d.v+
alidateFields(r)){return}sap.m.MessageToast.show(I.getText("inforInProcess"));d.ExecuteActionProcess(r,e,t,a)}};V.onerror=function(e){o=false;d.handlerError(I.getText("errorReaderExcel"))};V.readAsBinaryString(e)}else{d.handlerError(I.getText("errorPageR+
eader"))}},validateFields:function(e){try{if(e.length==0){throw new UserException("ArquiveInvalid")}e.forEach(e=>{e.CodigoCenario=e.CodigoCenario==null?"":e.CodigoCenario;e.Data=e.Data==null?"00000000":e.Data;e.Material=e.Material==null?"":e.Material;e.T+
ipoAvaliacao=e.TipoAvaliacao==null?"":e.TipoAvaliacao;e.Docnum=e.Docnum==null?"":e.Docnum;e.Empresa=e.Empresa==null?"":e.Empresa;e.CodigoCentro=e.CodigoCentro==null?"":e.CodigoCentro;e.Divisao=e.Divisao==null?"":e.Divisao;e.ValorICMS=e.ValorICMS==null?0:+
e.ValorICMS;e.ValorICMSST=e.ValorICMSST==null?0:e.ValorICMSST;e.ValorIPI=e.ValorIPI==null?0:e.ValorIPI;if(e.ValorICMS!=0){e.ValorICMS=e.ValorICMS.replaceAll(" ","");e.ValorICMS=e.ValorICMS.replaceAll("-","");e.ValorICMS=e.ValorICMS.replaceAll(",",".")}if+
(e.ValorICMSST!=0){e.ValorICMSST=e.ValorICMSST.replaceAll(" ","");e.ValorICMSST=e.ValorICMSST.replaceAll("-","");e.ValorICMSST=e.ValorICMSST.replaceAll(",",".")}if(e.ValorIPI!=0){e.ValorIPI=e.ValorIPI.replaceAll(" ","");e.ValorIPI=e.ValorIPI.replaceAll("+
-","");e.ValorIPI=e.ValorIPI.replaceAll(",",".")}e.ValorICMS=e.ValorICMS==""?0:e.ValorICMS;e.ValorICMSST=e.ValorICMSST==""?0:e.ValorICMSST;e.ValorIPI=e.ValorIPI==""?0:e.ValorIPI;e.Data=e.Data.replaceAll(".","");e.Data=e.Data.replaceAll("-","");e.Data=e.D+
ata.replaceAll("/","");e.Data=e.Data.replaceAll(":","");e.Data=e.Data.slice(4)+"-"+e.Data.slice(2,4)+"-"+e.Data.slice(0,2)})}catch(t){if(e.length==0){d.handlerError(I.getText("errorArquiveInitial"))}else{d.handlerError(I.getText("errorLayoutIncorrect"))}+
return false}return true},ExecuteActionProcess:function(e,t,a,r){var o=e.length;var s=0;try{sap.ui.getCore().getMessageManager().removeAllMessages()}catch(e){}try{e.forEach(e=>{a.callFunction("/toProcessUpload",{method:"POST",urlParameters:{Guid:"0000000+
0-0000-0000-0000-000000000000",FileDirectory:t.name,CodigoCenario:e.CodigoCenario,Data:e.Data,Material:e.Material,TipoAvaliacao:e.TipoAvaliacao,NotaFiscal:e.Docnum,Empresa:e.Empresa,Centro:e.CodigoCentro,Divisao:e.Divisao,ValorICMS:e.ValorICMS,ValorICMSS+
T:e.ValorICMSST,ValorIPI:e.ValorIPI,Moeda:"BRL"},success:function(e,t){s+=+1;d.successActionProcess(o,s,r)}.bind(this),error:function(e){s+=+1;d.errorActionProcess(e,s)}.bind(this),refreshAfterChange:true})})}catch(e){d.handlerError(I.getText("errorToPro+
cessAction"))}},successActionProcess:function(e,t,a){try{var r=new p;r.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());f.setModel(r);m.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);if(sap.ui.ge+
tCore().getMessageManager().getMessageModel().getData().length!=0){m.setIcon(i.getIconURI("message-success"));m.setType("Success");m.setVisible(true);f.navigateBack();y.setVisible(false);h.open()}else{m.setVisible(false)}}catch(e){m.setVisible(false);sap+
.m.MessageToast.show(I.getText("inforReturn"))}try{S.setBusy(false);T.setEnabled(true);S.close()}catch(e){d.handlerError(I.getText("errorDialog"))}try{if(a){a.getModel().refresh(true)}}catch(e){}},errorActionProcess:function(e,t){if(t==1){try{var a=new p+
;a.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());f.setModel(a);m.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);try{var r=JSON.parse(e.responseText);if(r.error.code=="005056A509B11EE1B9A8DBD9E+
A7BB778"){let e=[];e.push({message:I.getText("errorModelExcel"),type:"Error"});a.setData(e);f.setModel(a);m.setText("1")}}catch(e){}try{if(sap.ui.getCore().getMessageManager().getMessageModel().getData().length==0){let e=[];e.push({message:I.getText("err+
orToReceiveReturnVS"),type:"Error"});e.push({message:I.getText("inforSuport"),type:"Information"});let t=new p;t.setData(e);f.setModel(t);m.setText("1")}}catch(e){}m.setIcon(i.getIconURI("message-error"));m.setType("Negative");m.setVisible(true);f.naviga+
teBack();y.setVisible(false);h.open()}catch(e){sap.m.MessageToast.show(I.getText("errorToGetMessageReturn"))}try{S.setBusy(false);T.setEnabled(true)}catch(e){}}},handlerError:function(e){let t=[];t.push({message:e,type:"Error"});var a=new p;a.setData(t);+
f.setModel(a);m.setText("1");m.setIcon(i.getIconURI("message-error"));m.setType("Negative");m.setVisible(true);f.navigateBack();y.setVisible(false);h.open();S.setBusy(false);T.setEnabled(true)},onGetModelFile:function(e){var a=[];a.push({label:"CodigoCen+
ario",property:"CodigoCenario",type:sap.ui.model.type.String});a.push({label:"Data",property:"Data",type:sap.ui.model.type.Date});a.push({label:"Material",property:"Material",type:sap.ui.model.type.String});a.push({label:"TipoAvaliacao",property:"TipoAva+
liacao",type:sap.ui.model.type.String});a.push({label:"Docnum",property:"Docnum",type:sap.ui.model.type.String});a.push({label:"Empresa",property:"Empresa",type:sap.ui.model.type.String});a.push({label:"CodigoCentro",property:"CodigoCentro",type:sap.ui.m+
odel.type.String});a.push({label:"Divisao",property:"Divisao",type:sap.ui.model.type.Integer});a.push({label:"ValorICMS",property:"ValorICMS",type:sap.ui.model.type.Float});a.push({label:"ValorICMSST",property:"ValorICMSST",type:sap.ui.model.type.Float})+
;a.push({label:"ValorIPI",property:"ValorIPI",type:sap.ui.model.type.Float});var r={workbook:{columns:a},dataSource:[{Data:"01/01/0001"}],count:1,fileName:"BancoDeImpostos.xlsx"};var o=new t(r);o.build().finally(function(){o.destroy()})}}});              
//# sourceMappingURL=ListReportExt.controller.js.map                                                                                                                                                                                                           